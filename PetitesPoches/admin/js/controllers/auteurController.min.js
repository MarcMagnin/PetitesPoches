var Auteur=function(){this.Nom="";this.Prenom="";this.Photo="";this.LienBiblio=""},Update=function(){this.Type="";this.Name=""};app.controller("auteurController",["$scope","$rootScope","$http","$filter","$upload","$state","$modal",function(n,t,i,r,u,f,e){n.entityName="Auteur";n.itemsPool=[];n.items=[];n.tags=[];n.selectedItem="";n.container=$(".tilesContainer");n.menuShown=!0;n.init=function(){itemAdded=0;i({method:"GET",url:t.apiRootUrl+"/indexes/"+n.entityName+"?start=0&pageSize=200&sort=-Nom&_="+Date.now()}).success(function(t){n.itemsPool=t.Results;angular.forEach(t.Results,function(t){t.Id=t["@metadata"]["@id"];n.items.unshift(t)})}).error(function(n){console.log(n)})};n.filterByLetter=function(n){var t=$(".tilesContainer"),i="[class*='filter-"+n.toLowerCase()+"']";t.isotope({filter:i})};n.unFilter=function(){$container.isotope({filter:"*"})};n.select=function(t,i){if(n.selectedItem=t,!$(i.target).closest("a").length){var r=e.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",resolve:{selectedItem:function(){return n.selectedItem},parentScope:function(){return n}}});r.result.then(function(){n.save(n.selectedItem)},function(){})}};n.add=function(){var r=new Auteur;n.selectedItem=r;i({method:"PUT",headers:{"Raven-Entity-Name":n.entityName},url:t.apiRootUrl+"/docs/"+n.entityName+"%2F",data:angular.toJson(r)}).success(function(t){r.Id=t.Key;r.new=!0;n.itemsPool.unshift(r);n.items.unshift(r);var i=e.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",resolve:{selectedItem:function(){return n.selectedItem},parentScope:function(){return n}}});i.result.then(function(){n.save(n.selectedItem)},function(){n.delete(n.selectedItem)})}).error(function(n){console.log(n)})};n.updatePhoto=function(i){var r=i[0],f=new FileReader;f.onload=function(i){n.upload=u.http({url:t.apiRootUrl+"/static/"+n.selectedItem.Id+"/"+r.name,method:"PUT",headers:{"Content-Type":r.type},data:i.target.result}).progress(function(n){console.log("percent: "+parseInt(100*n.loaded/n.total))}).success(function(){n.addPhotoToAuteur(r.name,n.selectedItem)}).error(function(){alert("Error occured during upload")})};f.readAsArrayBuffer(r)};n.addPhotoToAuteur=function(r,u){var e=t.apiRootUrl+"/static/"+u.Id+"/"+r,f=new Update;f.Type="Set";f.Name="Photo";f.Value=e;i({method:"PATCH",headers:{"Raven-Entity-Name":n.entityName},url:t.apiRootUrl+"/docs/"+u.Id,data:angular.toJson(new Array(f))}).success(function(){u.Photo=e}).error(function(){})};n.addDragAndDrop=function(r){var f=r[0],e=new Auteur;i({method:"PUT",headers:{"Raven-Entity-Name":n.entityName},url:t.apiRootUrl+"/docs/"+n.entityName+"%2F",data:angular.toJson(livre)}).success(function(i){livre.Id=i.Key;livre.new=!0;n.items.push(livre);var r=new FileReader;r.onload=function(i){n.upload=u.http({url:t.apiRootUrl+"/static/"+livre.Id+"/"+f.name,method:"PUT",headers:{"Content-Type":f.type},data:i.target.result}).progress(function(n){console.log("percent: "+parseInt(100*n.loaded/n.total))}).success(function(){n.addImageToLivre(f.name,livre)}).error(function(){alert("Error occured during upload")})};r.readAsArrayBuffer(f)}).error(function(n){console.log(n)})};n.delete=function(r,u){u&&(u.stopPropagation(),u.stopImmediatePropagation());r.Photo&&i({method:"DELETE",url:t.apiRootUrl+"/"+r.Photo}).success(function(){}).error(function(n){console.log(n)});i({method:"DELETE",headers:{"Raven-Entity-Name":n.entityName},url:t.apiRootUrl+"/docs/"+r.Id}).success(function(){n.items.splice(n.items.indexOf(r),1);setTimeout(function(){n.container.isotope("reLayout")},100)}).error(function(n){console.log(n)})};n.save=function(r){delete r.new;i({method:"PUT",headers:{"Raven-Entity-Name":n.entityName},url:t.apiRootUrl+"/docs/"+r.Id,data:angular.toJson(r)}).success(function(){n.container.isotope("updateSortData",n.container.find(".isotopey"));n.container.isotope({sortBy:"nom"})}).error(function(n){console.log(n)})};n.sort=function(){console.log("sort");n.container.isotope("updateSortData",n.container.find(".isotopey"));n.container.isotope({sortBy:"nom"})}}]);
//# sourceMappingURL=auteurController.min.js.map
