function cleanString(n){return n.replace(/[^\w\s]/gi,"").toLowerCase().replace(/ /g,"")}var Livre=function(){this.Index=0;this.Titre="";this.Couverture="";this.Auteur={Nom:"",Prenom:""};this.Prix="";this.ISBN="";this.EBookUrl="";this.NiveauLecture="";this.PrixLitteraire="";this.FichePedago="";this.Extrait="";this.SiteMarchand="";this.LienVideo="";this.LienIssu=""};app.controller("livreController",function(n,t,i,r,u,f,e,o,s,h){function b(){}var a,w,v,c,y,l,p;n.entityName="Livre";n.items=[];n.itemsPool=[];n.tags=[];n.selectedItem="";n.searchedAuteur="";n.searchedText="";n.searchSelectedItem="";n.whiteSpacePattern="/ /g";n.searchTimeout;n.container=$(".tilesContainer");n.niveauLecture="";n.themeMultiselectSettings={displayProp:"Name",idProp:"Name"};n.themeMultiselectmodel=[];n.searchItems=[];n.dataReady=!1;n.loadMore=function(){alert("test")};n.init=function(){var u=TweenMax.staggerFrom("md-item",2,{scale:.85,opacity:0,ease:Elastic.easeOut,force3D:!0},.15,onCompleteAll=function(){n.menuShown=!0});TweenMax.to(".progressIndicator",.2,{opacity:1,display:"block"});$(".searchBar").focusin(function(){if(y){$(".searchBar").blur();return}n.toggleSearch()});$(".searchBar").focusout(function(){n.closeSearch()});n.menuShown=!1;itemAdded=0;o.getLivres().then(function(t){n.itemsPool=t;delayLoop(t,0,.1,function(i){i.Id=i["@metadata"]["@id"];i.filter=i.Titre.split(" ").map(function(n){return"fil-"+cleanString(n)}).join(" ");i.Auteur.Nom&&(i.filter+=" fil-"+cleanString(i.Auteur.Nom));i.Auteur.Prenom&&(i.filter+=" fil-"+cleanString(i.Auteur.Prenom));i.PrixLitteraires&&(i.filter+=" f-prix");i.EBookUrl&&(i.filter+=" f-ebook");i.FichePedago&&(i.filter+=" f-pedago");i.NiveauLecture&&(i.filter+=" f-"+i.NiveauLecture);i.Tags&&(i.filter+=" "+h("filterString")(i.Tags));n.items.unshift(i);n.items.length==t.length&&(n.dataReady=!0);n.$apply()});i.auteur&&(n.searchedText=i.auteur,n.setSearchPattern())});r({method:"GET",url:t.apiRootUrl+"/indexes/Tags?pageSize=30&sort=Name&noCache=1015157938&_="+Date.now()}).success(function(t){n.tags=t.Results}).error(function(n){console.log(n)})};a=!1;w=!1;n.toggleSearch=function(){a||(a=!0,$("#searchitem").addClass("toggled"),$("#searchIcon").addClass("toggled"),$(".searchBar").addClass("toggled"))};n.closeSearch=function(){setTimeout(function(){$("#searchitem, #searchIcon, .searchBar").removeClass("toggled");a=!1},100)};n.showListBottomSheet=function(t){$mdBottomSheet.show({templateUrl:"templates/bottomSheet.tmpl.html",controller:"ListBottomSheetCtrl",targetEvent:t,locals:{parentScope:n}}).then(function(){})};n.sideNavIcon="search";n.toggleLeft=function(){var n=$mdSidenav("left");n.toggle().then(function(){n.isOpen()&&$("#search").focus()})};n.closeLeft=function(){var n=$mdSidenav("left");n.close;$(".clear-icon").removeClass("toggled")};n.openLeft=function(){var n=$mdSidenav("left");n.open();$(".clear-icon").addClass("toggled")};n.select=function(t,i,r){n.selectedItem=t;$(r.target).closest("a").length||s.show({targetEvent:r,templateUrl:"templates/livreDialog.tmpl.html",controller:"ModalInstanceCtrl",onComplete:b,locals:{selectedItem:n.selectedItem,parentScope:n}})};n.getPrixSuggestions=function(i){return n.loading=!0,r.get(t.apiRootUrl+"/indexes/PrixLitteraireSuggestions",{params:{query:"Value:"+i+"*",pageSize:10,_:Date.now()}}).then(function(t){return n.loading=!1,t.data.Results})};n.cancel=function(){n.modalInstance.dismiss("cancel")};v=[];n.searchSuggestionsValue;n.searchLivreSuggestions=function(i){return n.searchSuggestionsValue=i,n.loadingSearchSuggestions=!0,r({method:"GET",url:t.apiRootUrl+"/indexes/LivreSearchSuggestions",params:{query:"Titre:"+i+"* OR Nom:"+i+"* OR Prenom:"+i+"*",pageSize:6,foobar:(new Date).getTime()}}).then(function(t){return n.loadingSearchSuggestions=!1,v.length=0,t.data.Results.forEach(function(t){v.push({Titre:t.Titre,Auteur:{Nom:t.Auteur.Nom,Prenom:t.Auteur.Prenom},imageUrl:n.apiRootUrl+"/"+t.Couverture})}),v})};c={key:"text",value:""};n.$watch("searchedText",function(t){n.searchedText&&n.searchItems.indexOf(c)==-1?(n.searchItems.push(c),$("#searchbutton").addClass("active")):n.searchedText||(n.searchItems.splice(n.searchItems.indexOf(c),1),$("#searchbutton").removeClass("active"));c.value=t});y=!1;n.validateSearchFromLivre=function(t){y=!0;setTimeout(function(){y=!1},200);n.searchedText=t.Auteur&&t.Auteur.Nom&&(t.Auteur.Nom.toLowerCase().indexOf(n.searchSuggestionsValue.toLowerCase())>-1||t.Auteur.Prenom.toLowerCase().indexOf(n.searchSuggestionsValue.toLowerCase())>-1)?t.Auteur.Prenom+" "+t.Auteur.Nom:t.Titre;n.validateSearch();n.closeSearch()};n.$watch("themeMultiselectmodel.length",function(){n.filtreThemes()});n.removeFilterTheme=function(t){var r,i;n.themeMultiselectmodel.splice(n.themeMultiselectmodel.indexOf(t),1);r=n.themeMultiselectmodel;n.themeMultiselectmodel=undefined;n.themeMultiselectmodel=[];angular.forEach(r,function(t){n.themeMultiselectmodel.push(t)});i=[];angular.forEach(n.tags,function(n){i.push(n)});n.tags.length=0;n.tags=i};n.removeFilter=function(t){n.searchItems.splice(n.searchItems.indexOf(t),1);switch(t.key){case"text":n.searchedText="";$(".searchBar").val("");n.searchPatternRecherche=null;break;case"fichePedago":n.searchPatternFichePedagogiques=null;n.checkboxFichePedagogiques=!1;break;case"ebook":n.searchPatternEBook=null;n.checkboxSearchEBook=!1;break;case"prix":n.searchPatternPrixLitteraires=null;n.checkboxPrixLitteraire=!1;break;case"niveau":n.niveauLecture="";n.filterPatternNiveauLecture=""}n.validateFilter()};n.validateFilter=function(){var t=(n.searchPatternRecherche?n.searchPatternRecherche:"")+(n.searchPatternTheme?n.searchPatternTheme:"")+(n.searchPatternFichePedagogiques?n.searchPatternFichePedagogiques:"")+(n.searchPatternEBook?n.searchPatternEBook:"")+(n.searchPatternPrixLitteraires?n.searchPatternPrixLitteraires:"")+(n.filterPatternNiveauLecture?n.filterPatternNiveauLecture:"");n.container.isotope({filter:t});n.searchTimeout=setTimeout(function(){$("#booksContainer").stop().animate({scrollLeft:"-=1px"},200)},200)};n.niveauLecture="";l={key:"niveau",value:""};n.$watch("niveauLecture",function(){if(n.filterPatternNiveauLecture=n.niveauLecture?".f-"+n.niveauLecture:"",n.validateFilter(),n.searchItems.indexOf(l)!=-1&&n.searchItems.splice(n.searchItems.indexOf(l),1),n.filterPatternNiveauLecture){$("#NiveauxButton").addClass("active");var t;switch(n.niveauLecture){case"premierspas":t="lecteur *";break;case"debutants":t="lecteur **";break;case"confirmes":t="lecteur ***"}l={key:"niveau",value:t};n.searchItems.push(l)}else $("#NiveauxButton").removeClass("active")});n.searchEBook=function(){n.searchPatternEBook=n.checkboxSearchEBook?".f-ebook":"";n.validateFilter()};n.searchFichePedagogiques=function(){n.searchPatternFichePedagogiques=n.checkboxFichePedagogiques?".f-pedago":"";n.validateFilter()};n.searchPrixLitteraires=function(){n.searchPatternPrixLitteraires=n.checkboxPrixLitteraire?".f-prix":"";n.validateFilter()};n.filtreNiveauLecture=function(){n.filterPatternNiveauLecture=n.niveauLecture?".f-"+n.niveauLecture:"";n.validateFilter()};p={Name:""};n.filtreThemes=function(t){t&&(t=t.toLowerCase(),p.Name=t,$.grep(n.themeMultiselectmodel,function(n){return n.Name==t}).length==0&&n.themeMultiselectmodel.push(p));n.searchPatternTheme=n.themeMultiselectmodel.map(function(n){return".f-"+cleanString(n.Name)}).join("");n.searchPatternTheme?$("#ThemesButton").addClass("active"):$("#ThemesButton").removeClass("active");n.validateFilter()};n.filtreAuteur=function(t){n.searchedText=t.Prenom+" "+t.Nom;n.validateSearch()};n.$on("FilterAvecAuteur",function(t,r){var u=i.auteur;console.log(u);r&&(n.searchedText=r.Prenom+" "+r.Nom,n.validateSearch())});n.filtreTheme=function(n){n=n.toLowerCase();t.$broadcast("updateThemesFilter",n)};n.clearFilters=function(){n.searchPatternEBook="";n.searchPatternPrixLitteraires="";n.searchPatternRecherche="";n.filterPatternNiveauLecture="";n.searchPatternTheme="";n.searchedText="";n.checkboxPrixLitteraire=!1;n.checkboxSearchEBook=!1;n.niveauLecture="";n.filtreTheme("");n.validateFilter();n.closeLeft()};n.setSearchPattern=function(){n.searchPatternRecherche=n.searchedText.Titre?n.searchedText.Titre.split(" ").map(function(n){return"[class*='fil-"+cleanString(n)+"']"}).join(""):n.searchedText.length==0?"*":n.searchedText.split(" ").map(function(n){return"[class*='fil-"+cleanString(n)+"']"}).join("")};n.validateSearch=function(){n.searchTimeout&&clearTimeout(n.searchTimeout);n.searchTimeout=setTimeout(function(){n.setSearchPattern();n.validateFilter()},100)};n.searchAuteurSuggestions=function(i){return n.loadingSearchSuggestions=!0,r({method:"GET",url:t.apiRootUrl+"/indexes/AuteurSearchSuggestion",params:{query:"Nom:"+i+"* OR Prenom:"+i+"*",resultsTransformer:"AuteurSearchTransform",pageSize:10}}).then(function(t){return n.loadingSearchSuggestions=!1,t.data.Results})};n.clear=function(){n.selectedItem.datePublication=null};n.toggleMin=function(){n.minDate=n.minDate?null:new Date};n.toggleMin();n.open=function(t){t.preventDefault();t.stopPropagation();n.opened=!0};n.dateOptions={formatYear:"yy",startingDay:1};n.formats=["dd-MMMM-yyyy","dd/MM/yyyy","dd.MM.yyyy","shortDate"];n.format=n.formats[1];n.sort=function(){setTimeout(function(){n.container.isotope({sortBy:"date"})},100)}});
//# sourceMappingURL=livreController.min.js.map
